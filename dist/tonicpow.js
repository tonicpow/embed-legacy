!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var n=class{constructor(e){for(let t in e)this[t]=e[t]}static get schema(){return{B:{},MAP:{},in:[]}}get bImgDataSrc(){if(this.B&&"binary"===this.B.encoding)return"data:"+this.B["content-type"]+";base64, "+this.B.content}get adType(){return this.MAP&&this.MAP.ad_type&&"funding"===this.MAP.ad_type?"funding":"display"}get ctaUrl(){if(this.MAP&&this.MAP.cta_url)return this.MAP.cta_url}get ctaText(){return this.MAP&&this.MAP.cta_text?this.MAP.cta_text:"Donate"}get affiliateAddress(){if(this.MAP&&this.MAP.affiliate_address&&"00"!==this.MAP.affiliate_address)return this.MAP.affiliate_address}get currency(){return this.MAP&&this.MAP.currency?this.MAP.currency:"usd"}get firstVinAddress(){if(this.in&&this.in[0]&&this.in[0].e.a)return this.in[0].e.a}};const o={TransformTxs:e=>{if(!e)throw new Error("Cant process tx",e);let t={"19HxigV4QyBv3tHpQVcUEQyq1pzZVdoAut":"B","1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5":"MAP","15PciHG22SNLQJXMoSUaWVi7WSqc7hCfva":"AUTHOR_IDENTITY"},r={B:[{content:"string"},{"content-type":"string"},{encoding:"string"},{filename:"string"}],MAP:[{cmd:"string"},[{key:"string"},{val:"string"}]],AUTHOR_IDENTITY:[{algo:"string"},{pubkey:"string"},{sig:"string"}]},n={},o=t[e.out.filter(e=>e&&106===e.b0.op)[0].s1],a=0;for(let s of Object.keys(e)){if("out"===s&&e[s].some(e=>e&&e.b0&&106===e.b0.op)){let i=e[s][0],l=0;for(let e in i){(e=i.hasOwnProperty(e)?e:i.hasOwnProperty("l"+e)?"l"+e:null)||(e="lb"+a,e="ls"+a);let s,c=i[e];if(!e.startsWith("s")&&!e.startsWith("ls")||"str"===e)continue;if(c.hasOwnProperty("op"))continue;if(Object.keys(t).some(e=>e===c)&&0===a){o=t[c];continue}if(a||(n[o]=[]),"|"===c){a=0;continue}let d=r[o][a],u={};if(d instanceof Array){l%=d.length,u[Object.keys(d[l++])[0]]=c,n[o].push(u)}else d&&(u[s=Object.keys(d)[0]]=c),n[o].push(u),a++}}n[s]=e[s]}let s,i={},l={},c=n;if(c.hasOwnProperty("MAP")){for(let e of c.MAP){let t=Object.keys(e)[0];"key"===t?s=Object.values(e)[0]:"val"===t&&(i[s]=Object.values(e)[0])}c.MAP=i}if(c.hasOwnProperty("B")){for(let e of c.B){l[Object.keys(e)[0]]=Object.values(e)[0]}l.hasOwnProperty("encoding")&&"binary"===l.encoding&&c.out.some(e=>e.s1===(void 0).B_PREFIX&&"binary"===e.s4)&&(l.content=c.out.filter(e=>e&&e.s1===(void 0).B_PREFIX).map(e=>e.lb2)[0]),c.B=l}return c}};var a=o;const s={},i={v:3,q:{find:{"out.s7":"1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5","out.s9":"app","out.s10":"tonicpow"}},limit:10},l=btoa(JSON.stringify(i));s.socket=null,s.callback=null,s.connect=(e=>{s.callback=e,s.socket=new EventSource("https://genesis.bitdb.network/s/1FnauZ9aUH2Bex6JzdcV4eNX7oLSSEbxtN/"+l),s.socket.onmessage=(e=>{let t=JSON.parse(e.data||{}).data||[],r=JSON.parse(e.data||{}).type||"";if(t)switch(r){case"open":s.callback(r,t);break;case"u":if(!t.length)return;s.callback(r,t);break;case"block":console.log("NEW BLOCK.",t)}}),s.socket.onerror=(e=>s.callback("error",e))});var c=s;const d={removeStorage:e=>{try{localStorage.removeItem(e),localStorage.removeItem(e+"_expiresIn")}catch(t){return console.log("removeStorage: Error removing key ["+e+"] from localStorage: "+JSON.stringify(t)),!1}return!0},getStorage:e=>{let t=Date.now(),r=localStorage.getItem(e+"_expires");if(null==r&&(r=0),r<t)return d.removeStorage(e),null;try{return localStorage.getItem(e)}catch(t){return console.log("getStorage: Error reading key ["+e+"] from localStorage: "+JSON.stringify(t)),null}},setStorage:(e,t,r=null)=>{r=r?Math.abs(r):86400;let n=Date.now()+1e3*r;try{localStorage.setItem(e,t),localStorage.setItem(e+"_expires",n)}catch(t){return console.log("setStorage: Error setting key ["+e+"] in localStorage: "+JSON.stringify(t)),!1}return!0}};var u=d;const g={lookup:async e=>{if(!e||!e.includes("$"))return console.error("invalid handcash handle: "+e),"";let t=u.getStorage(e);if(null!==t&&t.length>25)return console.log("handcash found locally, skipping lookup! "+e+":"+t),t;try{let r=await Promise.all([fetch("https://api.handcash.io/api/receivingAddress/"+e.substr(1)).then(e=>e.json())]);return"object"==typeof r&&r[0]&&r[0].hasOwnProperty("receivingAddress")?(t=r[0].receivingAddress).length>25?(u.setStorage(e,t,7200),t):(console.log("receivingAddress was invalid:",t,r),""):(console.log("handcash response was invalid or missing receivingAddress",r),"")}catch(t){return console.log(t,e),""}}};var f=g;let h={};h.Storage=u,h.Handcash=f,h.bmap=a,h.BitSocket=c,h.Tonic=n,h.Iframes=new Map,h.processTonics=(e=>{let t=[];for(let r of e){let e=new n(a.TransformTxs(r));t.push(e)}return t}),h.iframeLoader=(async()=>{const e=["bsv","usd"];let t=document.head.querySelector("[name=bitcoin-address][content]")?document.head.querySelector("[name=bitcoin-address][content]").content:"",r=document.head.querySelector("[name=bitcoin-tx][content]")?document.head.querySelector("[name=bitcoin-tx][content]").content:"",n=new URLSearchParams(window.location.search).get("affiliate");n&&(void 0===(n=n.includes("$")?await f.lookup(n):n)||!n||""===n||n.length<=25)&&(console.error("failed to set affiliate",n),n="");let o=document.getElementsByClassName("tonic");if(o&&0!==o.length){for(let a=o.length-1;a>=0;a--){let s=o[a],i=s.getAttribute("data-width");i&&""!==i||(i=300);let l=s.getAttribute("data-height");l&&""!==l||(l=250);let c=s.getAttribute("data-unit-id");c&&""!==c||(console.log("data-unit-id not found, using default: embed-1"),c="embed-1");let d=s.getAttribute("data-address");(void 0===d||!d||d.length<=25)&&(t?(d=t,console.log("data-address not found or invalid: "+d+" using sticker address: "+t)):(d="1LWyDs4qzmfAhGpSZk1K1kLmNdafBDdJSD",console.log("data-address not found or invalid: "+d+" using default address: 1LWyDs4qzmfAhGpSZk1K1kLmNdafBDdJSD")));let u=s.getAttribute("data-handcash"),g="";u&&u.includes("$")&&(void 0===(g=await f.lookup(u))||!g||""===g||g.length<=25?g="":d=g);let p=localStorage.getItem("affiliate_"+d);p?(n=p,console.log("existing affiliate found in local storage: "+n)):n&&(localStorage.setItem("affiliate_"+d,n),console.log("saving new affiliate in local storage: "+n));let y=s.getAttribute("data-rate");y&&""!==y||(y=546);let m=s.getAttribute("data-image");m&&""!==m||(m="");let b=s.getAttribute("data-link-color");b&&""!==b?6!==(b=b.replace(/[^a-zA-Z]+/g,"")).length&&3!==b.length&&(b=""):b="";let A=s.getAttribute("data-currency");A&&""!==A?-1===e.indexOf(A)&&(A="bsv",y=546):A="bsv",A=A.toLowerCase();let S=document.createElement("iframe");S.src="https://app.tonicpow.com/?unit_id="+c+"&address="+d+(n?"&affiliate="+n:"")+(t?"&sticker_address="+t:"")+(r?"&sticker_tx="+r:"")+"&rate="+y+"&currency="+A+"&width="+i+"&height="+l+(m?"&image="+m:"")+(b?"&link_color="+b:"")+"&cache="+Math.random(),S.width=i,S.height=parseInt(l)+28,S.id="tonic_"+c,S.setAttribute("scrolling","no"),S.setAttribute("data-unit-id",c),S.setAttribute("data-address",d),n&&S.setAttribute("data-affiliate",n),S.setAttribute("data-sticker-address",t),S.setAttribute("data-sticker-tx",r),S.setAttribute("data-handcash",u),S.setAttribute("data-link-color",b),S.importance="high",S.frameBorder="0",S.style.border="none",S.style.overflow="hidden",S.style.backgroundColor="transparent",S.allowTransparency="true",h.Iframes.set(c,d),s.parentNode.replaceChild(S,s)}console.log("Tonic Map:",h.Iframes)}else console.info("no tonic divs found with class 'tonic'")}),h.load=(()=>{h.iframeLoader(),c.connect((e,t)=>{if("error"===e)return void console.error(t);if("open"===e)return;let r=h.processTonics(t);if(r.length>0&&r[0].hasOwnProperty("tx")){let e=r[0];if(h.Iframes.get(e.MAP.ad_unit_id)===e.MAP.site_address){let t=document.getElementById("tonic_"+e.MAP.ad_unit_id);if(t){let n=new URLSearchParams(t.src).get("address");console.log("address",n,"tonic address",e.MAP.site_address,n&&n.length>25&&n===e.MAP.site_address),n&&n.length>25&&n===e.MAP.site_address&&t.contentWindow.postMessage({tonics:JSON.stringify(r)},"https://app.tonicpow.com")}}}})}),"complete"===document.readyState||"interactive"===document.readyState?(h.load(),console.log("loaded via document.readyState")):document.addEventListener("DOMContentLoaded",function(){h.load(),console.log("loaded via DOMContentLoaded")}),window.TonicPow=h}]);